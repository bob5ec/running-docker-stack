version: '3'

volumes:
  nextcloud:
  nextcloudDb:

services:

  db:
    container_name: db
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
  app:
    container_name: app
    environment:
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_TEST=nextcloud
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
      - MYSQL_HOST=db
      - NEXTCLOUD_ADMIN_USER=admin
      - NEXTCLOUD_ADMIN_PASSWORD=${NEXTCLOUD_ADMIN_PASSWORD}
      - NEXTCLOUD_TRUSTED_DOMAINS=coruscant.home.asd.bz coruscant localhost
    volumes:
      - nextcloud:/var/www/html
      - ./nextcloud/test/data:/data
      - ./nextcloud/test/data/nextcloud:/var/www/html/data
  config:
    container_name: config
    volumes:
      - ./nextcloud/config:/config
      - ./nextcloud/test/nextcloud-test/secrets:/secrets
      - nextcloud:/var/www/html
      - ./nextcloud/test/data:/data
      - ./nextcloud/test/data/nextcloud:/var/www/html/data
